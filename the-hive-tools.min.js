// ==UserScript==
// @name         the-hive-tools
// @namespace    http://tampermonkey.net/
// @version      0.6.6
// @description  add some little features to The Hive forum
// @author       EifelDriver
// @match        https://www.enter-the-hive.de/forum/*
// @update       https://raw.githubusercontent.com/eifeldriver/the-hive-tools/master/the-hive-tools.min.js?v=0.6.6
// @grant        none
// ==/UserScript==
(function(){"use strict";var js_name="the-hive-tools";var js_version="0.6.6";var js_debug=1;var watcher1,watcher2;var cfg={};var cfg_options={user_online:{type:"bool",label:"Benutzer online",val:"1"},highlight_friends:{type:"bool",label:"Freunde hervorheben",val:"1"},friends_list:{type:"list",label:"Freundesliste",val:[]},custom_absent:{type:"bool",label:"Custom-Abwesenheit",val:"1"},no_gallery_bubbles:{type:"bool",label:"keine Galerie-Bubbles.",val:"1"},direct_search:{type:"bool",label:"direkt zur Suche",val:"1"},bubbles_color:{type:"color",label:"Bubble-Farbe",val:"#ff0000"},game_service_destiny:{type:"bool",label:"Game-Service: Destiny",val:"0"},game_service_division:{type:"bool",label:"Game-Service: Division",val:"0"},game_service_anthem:{type:"bool",label:"Game-Service: Anthem",val:"0"},version:{type:"readonly",label:"Version",val:js_version},help:{type:"help",label:"Hilfe",val:"?",url:"https://github.com/eifeldriver/the-hive-tools/blob/master/README.md"},save:{type:"save",label:"&nbsp;",val:"speichern"}};var context_menu={user:{open:'<dt data-tht_menu="user" data-tht_task="open">open</dt>',add:'<dt data-tht_menu="user" data-tht_task="add">addToWatchlist</dt>',remove:'<dt data-tht_menu="user" data-tht_task="remove">removeFromWatchlist</dt>',activities:'<dt data-tht_menu="user" data-tht_task="activities">show activities</dt>'}};var thtMenu={user:{open:thtMenu_gotoUserProfile,add:thtMenu_addUserToWatchlist,remove:thtMenu_removeUserFromWatchlist,activities:thMenu_gotoUserActivities}};var status_icons={good:{img:"https://ubistatic-a.akamaihd.net/0115/tctd2/images/online.png",title:"Online"},failed:{img:"https://ubistatic-a.akamaihd.net/0115/tctd2/images/interrupted.png",title:"Offline"},bad:{img:"https://ubistatic-a.akamaihd.net/0115/tctd2/images/degradation.png",title:"???"},repair:{img:"https://ubistatic-a.akamaihd.net/0115/tctd2/images/maintenance.png",title:"Wartung"}};var server_status_bar={game_service_division:'<div class="game-status" id="game-status-division"><span>Division 2<i>\x3c!-- --\x3e</i></span><img src="#"></div>',game_service_destiny:'<div class="game-status" id="game-status-destiny"><span>Destiny 2<i>\x3c!-- --\x3e</i></span><img src="#"></div>',game_service_anthem:'<div class="game-status" id="game-status-anthem"><span>Anthem<i>\x3c!-- --\x3e</i></span><img src="#"></div>'};var css=[];if(true){css.push("#tht-dialog { position: fixed; z-index: 99999; background: #666; color: #ccc; border: 1px solid #ccc; }");css.push("#tht-dialog .inner { }");css.push("#tht-dialog dl { }");css.push("#tht-dialog dt { color: #ccc; padding: 2px 5px; }");css.push("#tht-dialog dt:hover { background: #ccc; color: #666; cursor: pointer; }");css.push("#tht-dialog dt:active { background: #fff; color: #333; cursor: progress; }");css.push("#tht-cfg-btn { text-transform: none; }");css.push("#tht-cfg-btn span {  }");css.push("#tht-cfg-btn .icon { display: inline-block; margin-left: 15px; }");css.push("#tht-cfg-section { height: 0; overflow: hidden; padding: 0; }");css.push("#tht-cfg-section.open { height: auto; }");css.push("#tht-cfg-wrapper { display: flex; flex-direction: row; padding: 15px 20px; font-size: 12px; font-weight: 400; }");css.push("#tht-cfg-wrapper .cfg-column { width: calc(100%/3); }");css.push("#tht-cfg-wrapper .cfg-column label { display: inline-block; width: 65%; }");css.push("#tht-cfg-wrapper input.color { width: 24px; }");css.push("#tht-cfg-wrapper label.opt-save { width: 0px; }");css.push("#tht-cfg-wrapper .field-save { width: 100%; }");css.push("#tht-game-status-bar { position: absolute; right: 315px; }");css.push("#tht-game-status-bar .game-status { display: inline-block; }");css.push("#tht-game-status-bar .game-status:hover { cursor: help; }");css.push("#tht-game-status-bar .game-status span { position: relative; display: inline-block; margin: 0 10px 0 25px; }");css.push("#tht-game-status-bar .game-status span i { display: inline-block; background: green; height: 2px; width: 100%; margin: 0; position: absolute; left: 0; bottom: -5px; }");css.push("#tht-game-status-bar .game-status img { display: inline-block; width: 24px; height: 24px; }");css.push("#my-users-online li .tht-highlight { color: #fff !important; padding: 2px 5px !important; display:inline-block; margin: 3px; }");css.push("#my-users-online a.userLink { font-style: italic; padding: 2px; }");css.push("#my-users-online a.userLink.dc-online { font-style: normal; border-bottom: 1px solid #aaa; }");css.push("#my-users-absent li { height: 2em; }");css.push("#my-users-absent li a {  }");css.push("#my-users-absent li span { display: block; width: 100%; position: relative; top: -1.5em; text-align: right; }");css.push("#goto-search-page { display: block; text-align: center; background: rgba(33, 33, 35, 1); padding: 5px 2px; text-transform: none; }");css=css.join(" ")}function _debug(txt){if(js_debug){var d=new Date;var now=[d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()].join(":");console.log(now+": "+txt)}}function getJsonData(json){var data=null;try{data=JSON.parse(json)}catch(err){data={}}return data}function insertCss(css,css_id){var style=document.createElement("STYLE");if(css_id){style.id=css_id}style.innerHTML=css;document.querySelector("head").appendChild(style)}function updateCss(css,css_id){var styles=document.querySelector("#"+css_id);if(styles){styles.parentNode.removeChild(styles)}insertCss(css,css_id)}function getCurrentContext(){var context="";switch(document.querySelector("body").id){case"tpl_wbb_boardList":context="frontpage";break;case"tpl_wcf_team":context="all_members";break;case"tpl_wcf_membersList":context="memberlist";break}return context}function getClickedElementType(e){var context="";var target=e.target;if(target.className.indexOf("userLink")!==-1||target.closest("a.userLink")){context="user"}return context}function openNewTab(url){var win=window.open(url,"_blank");win.focus()}function Ajax(url,callback){var success=false;if(window.XMLHttpRequest){var xhr=new XMLHttpRequest;xhr.onload=callback;xhr.open("GET",url);xhr.send();success=true}return success}function setDataToCache(key,data){var success=false;if(typeof key=="string"&&data){var cache_data={data:data,timestamp:Date.now()};localStorage.setItem(js_name+"_cache_"+key,JSON.stringify(cache_data));success=true}return success}function getDataFromCache(key,expire){var data=null;if(typeof expire!="number"){expire=60*60*24}if(typeof key=="string"){try{var cache_data=JSON.parse(localStorage.getItem(js_name+"_cache_"+key));if(cache_data===null){_debug("error : key doesnt exist in cache")}else{if(Date.now()-cache_data.timestamp<expire){data=cache_data.data;_debug('cached data for "'+key+'" loaded')}else{_debug('cached data for "'+key+'" has expired')}}}catch(err){_debug("error: cached data isnt a JSON string")}}return data}function saveConfig(data){var success=false;if(typeof data=="object"){localStorage.setItem(js_name,JSON.stringify(data));success=true;_debug("cfg saved");var instant_css=[];instant_css.push("#pageContainer .badge.badgeUpdate, #pageContainer a.badge.badgeUpdate { background-color: "+data.bubbles_color+"; } ");updateCss(instant_css.join(" "),"tht-custom-css")}return success}function loadConfig(){var data,property;try{data=JSON.parse(localStorage.getItem(js_name));if(data===null){throw"cfg loading error"}_debug("cfg loaded");for(property in cfg_options){if(!data.hasOwnProperty(property)){data[property]=cfg_options[property]["val"];_debug("add config option : "+property)}}_debug("cfg verified")}catch(err){data={};for(property in cfg_options){data[property]=cfg_options[property]["val"]}_debug("cfg loading failed - use default settings")}cfg=data;saveConfig(cfg)}function instantSaveCfgOption(e){var val;var elem=e.target;if(elem){var opt_key=elem.id.replace("cfg-","");switch(elem.dataset.cfg_type){case"bool":if(elem.checked){val=1}else{val=0}cfg[opt_key]=val;break;case"color":cfg[opt_key]=elem.value;break;case"text":cfg[opt_key]=elem.value;break}saveConfig(cfg)}}function thtMenu_gotoUserProfile(e){var dialog=e.target.closest("#tht-dialog");if(dialog){var infos=getTargetInfosFromDialog();removeDialog();location.href=infos.url}}function thtMenu_addUserToWatchlist(e){var dialog=e.target.closest("#tht-dialog");if(dialog){var infos=getTargetInfosFromDialog();var user_name=infos.innerText;if(cfg){if(cfg.friends_list.indexOf(user_name)==-1){cfg.friends_list.push(user_name);saveConfig(cfg)}}removeDialog();location.href=location.href}}function thtMenu_removeUserFromWatchlist(e){var dialog=e.target.closest("#tht-dialog");if(dialog){var infos=getTargetInfosFromDialog();var user_name=infos.innerText;if(cfg){var idx=cfg.friends_list.indexOf(user_name);if(idx!==-1){delete cfg.friends_list[idx];saveConfig(cfg)}}removeDialog();location.href=location.href}}function thMenu_gotoUserActivities(e){var dialog=e.target.closest("#tht-dialog");if(dialog){var infos=getTargetInfosFromDialog();location.href=infos.url+"i/#recentActivity";removeDialog()}}function insertCfgDialog(){var menu_sec=document.querySelector(".interactiveDropdownUserMenu .interactiveDropdownItemsContainer ul li");if(menu_sec){var cfg_btn=document.createElement("BUTTON");cfg_btn.id="tht-cfg-btn";cfg_btn.innerHTML='<span>THT-Optionen</span><i class="icon fa-angle-down"></i>';document.querySelector(".interactiveDropdownHeader").append(cfg_btn);cfg_btn.addEventListener("click",toggleCfgDialog);var cfg_sec=document.createElement("LI");cfg_sec.id="tht-cfg-section";var html=[];html.push('<div id="tht-cfg-wrapper">');html.push('<div id="cfg-col-1" class="cfg-column"></div>');html.push('<div id="cfg-col-2" class="cfg-column"></div>');html.push('<div id="cfg-col-3" class="cfg-column"></div>');html.push("</div>");cfg_sec.innerHTML=html.join("");menu_sec.parentNode.prepend(cfg_sec);buildCfgOptions();updateCfgSections()}}function toggleCfgDialog(e){e.target.blur();var dialog=document.querySelector("#tht-cfg-section");if(dialog){if(dialog.className.indexOf(" open")!=-1){dialog.className=dialog.className.replace(" open","")}else{dialog.className=dialog.className.replace(" open","")+" open"}}}function createCfgOption(property,container){if(container){if(cfg_options.hasOwnProperty(property)){var lbl=document.createElement("LABEL");var elem=document.createElement("INPUT");lbl.htmlFor=property;lbl.innerHTML=cfg_options[property]["label"];lbl.className="opt-"+property;elem.id="cfg-"+property;switch(cfg_options[property]["type"]){case"bool":elem.type="checkbox";elem.className="bool";elem.dataset.cfg_type="bool";break;case"color":elem.type="color";elem.className="color";elem.dataset.cfg_type="color";break;case"text":elem.type="text";elem.className="text";elem.dataset.cfg_type="text";break;case"readonly":elem=document.createElement("SPAN");elem.className="field-readonly";elem.innerText=js_version;break;case"help":elem=document.createElement("BUTTON");elem.className="field-help";elem.innerText=cfg_options[property]["val"];elem.addEventListener("click",function(){openNewTab(cfg_options[property]["url"])});break;case"save":elem=document.createElement("BUTTON");elem.className="field-save";elem.innerText=cfg_options[property]["val"];elem.addEventListener("click",function(){location.href=location.href});break}elem.addEventListener("change",instantSaveCfgOption);var row=document.createElement("DIV");row.className="opt-row";row.appendChild(lbl);row.appendChild(elem);container.appendChild(row)}}}function updateCfgSections(){var cfg_sec=document.querySelector("#tht-cfg-section");if(cfg_sec){for(var property in cfg_options){var opt=document.querySelector("#cfg-"+property);if(opt){switch(opt.dataset.cfg_type){case"bool":if(cfg[property]){opt.checked="checked"}else{opt.checked=""}break;case"color":if(cfg[property]){opt.value=cfg[property]}else{opt.value=""}break;case"text":break}}}}}function buildCfgOptions(){var sec;var cfg_sec=document.querySelector("#tht-cfg-section");if(cfg_sec){sec=document.querySelector("#tht-cfg-section #cfg-col-1");if(sec){createCfgOption("user_online",sec);createCfgOption("highlight_friends",sec);createCfgOption("custom_absent",sec);createCfgOption("no_gallery_bubbles",sec);createCfgOption("direct_search",sec)}sec=document.querySelector("#tht-cfg-section #cfg-col-2");if(sec){createCfgOption("bubbles_color",sec);createCfgOption("game_service_division",sec);createCfgOption("game_service_destiny",sec);createCfgOption("game_service_anthem",sec)}sec=document.querySelector("#tht-cfg-section #cfg-col-3");if(sec){createCfgOption("version",sec);createCfgOption("help",sec);createCfgOption("save",sec)}}}function openDialog(menu_type,e){removeDialog();var wrapper=document.createElement("div");wrapper.id="tht-dialog-wrapper";wrapper.innerHTML='<div id="tht-dialog"><div class="inner"><dl></dl></div></div>';document.querySelector("body").appendChild(wrapper);var dialog=document.querySelector("#tht-dialog");var infos=setTargetInfosToDialog(e.target);switch(menu_type){case"user":dialog.style.top=e.y+"px";dialog.style.left=e.x+"px";addDialogOption(dialog,"user","open");if(isUserOnWatchlist(infos.innerText)){addDialogOption(dialog,"user","remove")}else{addDialogOption(dialog,"user","add")}addDialogOption(dialog,"user","activities");break}initDialogMenu(dialog);document.querySelector("body").addEventListener("click",function(e){var target=e.target;var dialog_click=target.closest("#tht-dialog-wrapper");if(!dialog_click){removeDialog()}},true)}function removeDialog(){var dialog=document.querySelector("#tht-dialog-wrapper");if(dialog){dialog.parentNode.removeChild(dialog)}}function setTargetInfosToDialog(target){var infos=null;var dialog=document.querySelector("#tht-dialog");if(dialog&&target){if(target.tagName.toLowerCase()!=="a"){target=target.closest("a.userLink")}infos={url:target.href,innerText:target.innerText};dialog.dataset.target=JSON.stringify(infos)}return infos}function getTargetInfosFromDialog(){var infos=null;var dialog=document.querySelector("#tht-dialog");if(dialog){infos=JSON.parse(dialog.dataset.target)}return infos}function addDialogOption(dialog,menu_type,opt_name){if(dialog&&context_menu&&context_menu.hasOwnProperty(menu_type)&&typeof context_menu[menu_type]=="object"){dialog.querySelector("dl").innerHTML+=context_menu[menu_type][opt_name]}}function initDialogMenu(dialog){if(typeof dialog=="object"){var items=dialog.querySelectorAll("dt[data-tht_task]");items.forEach(function(item){item.addEventListener("click",thtMenu[item.dataset.tht_menu][item.dataset.tht_task])})}}function updateTimerBar(game){var refresh_timer=document.querySelector("#game-status-"+game+" span > i");if(refresh_timer){var percent=parseInt(refresh_timer.style.width);if(percent<2){refresh_timer.style.width="100%"}else{refresh_timer.style.width=percent-1+"%"}}}function updateGameStatus_Division(){var refresh_seconds=120;var server_status=getDataFromCache("game-status-division",refresh_seconds);if(server_status===null){Ajax("https://game-status-api.ubisoft.com/v1/instances?appIds=6c6b8cd7-d901-4cd5-8279-07ba92088f06,6f220906-8a24-4b6a-a356-db5498501572,7d9bbf16-d76d-43e1-9e82-1e64b4dd5543",function(data){if(data&&this.status==200){var json=getJsonData(data.currentTarget.response);if(typeof json=="object"&&json.hasOwnProperty("0")){switch(json[0].Status.toLowerCase()){case"online":server_status="good";break;case"offline":server_status="failed";break;case"maintenance":server_status="repair";break;default:server_status="bad";break}setDataToCache("game-status-division",server_status);var img=document.querySelector("#game-status-division img");if(img){img.src=status_icons[server_status].img;img.title=status_icons[server_status].title}var refresh_timer=document.querySelector("#game-status-division span > i");refresh_timer.style.width="100%";window.setInterval(function(){updateTimerBar("division")},refresh_seconds*1e3/100)}}})}else{var img=document.querySelector("#game-status-division img");if(img&&typeof server_status=="string"){img.src=status_icons[server_status].img;img.title=status_icons[server_status].title}}}function updateGameStatus_Destiny(){var server_status=getDataFromCache("game-status-destiny",60);if(server_status===null){server_status=status_icons.bad;setDataToCache("game-status-destiny",server_status);var img=document.querySelector("#game-status-destiny img");if(img){img.src=status_icons["bad"].img;img.title="noch nicht fertig"}var refresh_timer=document.querySelector("#game-status-destiny span > i");refresh_timer.style.width="0%"}}function updateGameStatus_Anthem(){var server_status=getDataFromCache("game-status-anthem",60);if(server_status===null){server_status=status_icons.bad;setDataToCache("game-status-anthem",server_status);var img=document.querySelector("#game-status-anthem img");if(img){img.src=status_icons["bad"].img;img.title="noch nicht fertig"}var refresh_timer=document.querySelector("#game-status-anthem span > i");refresh_timer.style.width="0%"}}function addServerStatusBar(){var nav_bar=document.querySelector(".pageNavigation .layoutBoundary");if(nav_bar){nav_bar.style.position="relative";var status_bar=document.createElement("DIV");status_bar.id="tht-game-status-bar";if(cfg.game_service_division){status_bar.innerHTML+=server_status_bar.game_service_division}if(cfg.game_service_destiny){status_bar.innerHTML+=server_status_bar.game_service_destiny}if(cfg.game_service_anthem){status_bar.innerHTML+=server_status_bar.game_service_anthem}nav_bar.appendChild(status_bar);if(cfg.game_service_division){updateGameStatus_Division();window.setInterval(updateGameStatus_Division,6e4)}if(cfg.game_service_destiny){updateGameStatus_Destiny();window.setInterval(updateGameStatus_Destiny,6e4)}if(cfg.game_service_anthem){updateGameStatus_Anthem();window.setInterval(updateGameStatus_Anthem,6e4)}}}function getDiscordUsersOnline(){var dc_users=document.querySelectorAll(".scDiscordWidget .widget-member");if(dc_users){var cache_data=getDataFromCache("dc_users",60);if(cache_data===null){var users={};dc_users.forEach(function(user){var user_avatar,user_nick,user_name,user_game,dc_name;dc_name=user.querySelector(".widget-member-name").innerText;user_avatar=user.querySelector(".widget-member-avatar img").src;user_game=user.querySelector(".widget-member-game");if(user_game){user_game=user_game.innerText.trim()}else{user_game=""}if(dc_name.indexOf("|")!==-1){user_nick=dc_name.split("|").shift().trim();user_name=dc_name.split("|").pop().trim()}else{user_nick=user_name=dc_name.trim()}users[user_nick]={nick:user_nick,name:user_name,avatar:user_avatar,game:user_game}});setDataToCache("dc_users",users)}else{}}}function isDcUserOnline(user,dc_users){if(typeof dc_users!=="object"){dc_users=getDiscordUsersOnline()}var is_online=false;if(dc_users&&typeof user=="string"){is_online=dc_users.hasOwnProperty(user)}return is_online}function addPortletUsersOnline(){if(cfg.user_online){var users=document.querySelector("section.box[data-box-identifier='com.woltlab.wcf.UsersOnline']");if(users){var sidebar=document.querySelector(".sidebar.boxesSidebarRight .boxContainer");if(sidebar){var box=document.createElement("SECTION");box.id="my-users-online";box.className="box";box.innerHTML=users.innerHTML;sidebar.prepend(box);makeFriendsSelectable("#my-users-online");highlightFriends("#my-users-online")}}}}function makeFriendsSelectable(selector){if(cfg.highlight_friends){var users=document.querySelectorAll(selector+" a.userLink");var dc_users=getDataFromCache("dc_users",60);users.forEach(function(item){item.addEventListener("click",showUserDialog,false);if(isDcUserOnline(item.innerText.trim(),dc_users)){item.className=item.className.replace(" dc-online","")+" dc-online";var user_info=dc_users[item.innerText.trim()];item.title=user_info.name+(user_info.game?" ["+user_info.game+"]":"")}})}}function showUserDialog(e){if(e.button==0){e.preventDefault();e.stopPropagation();var elem=e.target;if(elem.tagName.toLowerCase()=="font"){elem=elem.parentNode}openDialog("user",e);return false}}function isUserOnWatchlist(user_name){var found=false;if(cfg){if(cfg.friends_list.indexOf(user_name)!==-1){found=true}}return found}function highlightFriends(selector){if(cfg.highlight_friends){var users=document.querySelectorAll(selector+" a.userLink");users.forEach(function(item){if(isUserOnWatchlist(item.innerText)){var font=item.querySelector("font");if(!font){item.style.backgroundColor="#666666";item.style.color="#333 !important";item.className=item.className.replace(" tht-highlight","")+" tht-highlight"}else{var color=font.color;font.style.backgroundColor=color;font.className=font.className.replace(" tht-highlight","")+" tht-highlight"}}})}}function addPortletUsersAbsent(){if(cfg.custom_absent){var data=getDataFromCache("user-absent");if(data===null){Ajax("https://www.enter-the-hive.de/forum/absent-members-list/",updateUsersAbsentPortlet);data=""}var html=[];html.push('<h2 class="boxTitle"><a href="https://www.enter-the-hive.de/forum/absent-members-list/">Benutzer abwesend</a></h2>');html.push('<div class="boxContent"><ol>'+data.trim()+"</ol></div>");html=html.join("");var sidebar=document.querySelector(".sidebar.boxesSidebarRight .boxContainer");if(sidebar){var box=document.createElement("SECTION");box.id="my-users-absent";box.className="box";box.innerHTML=html;var wbb_box=document.querySelector(".sidebar .box[data-box-identifier='com.uz.wcf.absence.absentMembers']");if(wbb_box){wbb_box.parentNode.removeChild(wbb_box)}var dc_box=document.querySelector(".sidebar .box[data-box-identifier='de.softcreatr.wsc.DiscordWidgetBox']");if(dc_box.nextSibling){sidebar.insertBefore(box,dc_box.nextSibling)}else{sidebar.appendChild(box)}}}}function updateUsersAbsentPortlet(data){if(data&&this.status==200){var parser=new DOMParser;var dom=parser.parseFromString(data.currentTarget.response,"text/html");var users=[];var html="";dom.querySelectorAll("ol .containerHeadline H3 a").forEach(function(item,idx){users.push({name:item.innerText.trim(),url:item.href,absent:""})});dom.querySelectorAll(".details .commaSeparated").forEach(function(item,idx){var tmp=item.innerText.trim().split("\n");users[idx]["absent"]=tmp[2].trim().replace("abwesend bis","").split(",").shift()});users.forEach(function(user){html+='<li><a href="'+user.url+'" title="gehe zum Benutzerprofil">'+user.name+"</a><span>"+user.absent+"</span></li>"});var list=document.querySelector("#my-users-absent .boxContent ol");list.innerHTML=html.trim();setDataToCache("user-absent",html)}}function hideGalleryNotifications(){if(cfg.no_gallery_bubbles){var bubbles=document.querySelectorAll(".boxMenu li[data-identifier='com.woltlab.gallery.Gallery'] .badgeUpdate");if(bubbles.length){bubbles.forEach(function(elem){elem.parentNode.removeChild(elem)})}}}function modifyQuickSearch(){if(cfg&&cfg.direct_search){var bar=document.querySelector("#pageHeaderSearch");if(bar){var span=document.createElement("SPAN");span.id="goto-search-page";span.className="button";span.innerHTML='<a href="/forum/search/" title="direkt zur Suche">direkt zur erweiterten Suche</a>';bar.appendChild(span)}}}function startScript(){_debug("the-hive-tools started");loadConfig();updateCss(css);insertCfgDialog();switch(getCurrentContext()){case"frontpage":getDiscordUsersOnline();addPortletUsersOnline();addPortletUsersAbsent();addServerStatusBar();hideGalleryNotifications();break;case"all_members":hideGalleryNotifications();break;default:hideGalleryNotifications();modifyQuickSearch();break}}startScript()})();